---
title: Image reconstruction using backward projection
---
<p>
<br>
<hr>
<hr>
In photoacoustic tomography (PAT), for example, short-pulses of laser are first delivered into biological tissues, 
which are to be absorbed by the tissue, particularly the blood vessels. Ultrasonic waves are consequently produced via thermos-
elastic expansion. By projecting the ultrasonic wave backward toward the tissue (in a way similar to time-reversal),
the initial ultrasonic pressure distribution can be recognized, rendering an image of the vessels. 
This can be used to characterize the tissue properties. The forward propagation of the emitted ultrasonic wave from the source 
is simulated with the k-Wave toolbox. The received signals are backward projected with the mSOUND toolbox for the initial source 
image reconstruction. 
<hr>
<hr>
</p>



<!---2D backward Simulation--->
<h6>forward propagation with k-Wave</h6>
<hr>
<p> 
The forward propagation of the emitted ultrasonic wave from the source is simulated with the k-Wave toolbox.     
An initial source with the ‘mSOUND’ shape is used in this example for the illustration of the simulation with backward projection. 
<pre>
<code>
<font color="#03a852">% define the computational domain</font>   
Nx = 800;   <font color="#03a852">% number of grid points in the x-direction</font>
Ny = 300;   <font color="#03a852">% number of grid points in the y-direction</font>
dx = 1.3393e-04;   <font color="#03a852">% [m]</font>   
dy = 1.3393e-04;   <font color="#03a852">% [m]</font>   
kgrid = makeGrid(Nx, dx, Ny, dy);
dt = 1.1161e-08;   <font color="#03a852">% [s]</font>   
kgrid.t_array = 0:dt:3.4286e-05; 

<font color="#03a852">% assign the properties of the propagation medium</font>   
medium.sound_speed = 1500*ones(Nx, Ny);
medium.BonA        = 2.0*(0-1.0);
medium.density     = 1000*ones(Nx, Ny);
medium.alpha_coeff = 0.0; 
medium.alpha_power = 2.0;

<font color="#03a852">% define source and sensor</font>   
load mSOUND_logo.mat   <font color="#03a852">% load the initial source distribution</font>   
p0 = 1; 
source.p = p0;
source.p_mask = s;
sensor.mask = zeros(Nx, Ny); 
sensor.mask(:, 250) = 1; 

<font color="#03a852">% excitation signal</font>   
sample_freq = 1/dt;  <font color="#03a852">[Hz]</font> 
signal_freq = 1e6;   <font color="#03a852">[Hz]</font> 
source_mag = p0;     <font color="#03a852">[Pa]</font> 

<font color="#03a852">% set the input options</font>  
input_args = {'DisplayMask', sensor.mask, 'DataCast', 'single',...
                 'PlotScale',[-source_mag/2, source_mag/2]};
sensor.record = {'p'};

<font color="#03a852">% run the simulation with k-Wave</font>  
sensor_data = kspaceFirstOrder2D(kgrid, medium, source, sensor, input_args{:});
kwave_P_time = reshape(sensor_data.p, Nx, length(kgrid.t_array));
</code>
</pre>
<img src="/mSOUND/img/backward_logo.jpg" alt="backward projection example">
</p>

<!---2D backward Simulation--->
<h6>2D backward simulation</h6>
<hr>
<p> 
The <span style="background-color:#f1f1f1">source_p</span>
required for the function <a href="/mSOUND/function.html#Backward2D">Backward2D</a> is the signals recorded at the right boundary 
of Figure. a, generated by k-Wave.  
<pre>
<code>
clear medium
medium.c0 = 1500; <font color="#03a852">% reference speed of sound [m/s]</font>    

<font color="#03a852">% define the computational domain</font>   
num_x = Nx;    <font color="#03a852">% number of grid points in the x-direction</font>
num_y = 200;   <font color="#03a852">% number of grid points in the y-direction</font>
dt = 8*dt;     <font color="#03a852">% time step in TMDM [s]</font> 
x_length = num_x*dx; 
y_length = num_y*dy;
t_length = kgrid.t_array(end); 

mgrid = set_grid(dt, t_length, dx, x_length, dy, y_length);

<font color="#03a852">% define the computational domain</font>   
source_p = kwave_P_time(:, 1:8:end).';

<font color="#03a852">% assign the properties of the propagation medium</font>   
medium.c    = 1500;
medium.rho  = 1000;
medium.beta = 0;
medium.ca   = 0;
medium.cb   = 2.0;
medium.NRL_gamma = 0.9;
medium.NRL_alpha = 0.009;

<font color="#03a852">% backward projection with TMDM to reconstruct the initial source distribution</font>  
sensor_mask = ones(mgrid.num_x, mgrid.num_y+1);
p = Backward2D(mgrid, medium, source_p, sensor_mask, 0, 'NRL'); 
</code> 
</pre>
Figure. b shows the reconstructed source distribution with the time-reversal algorithm in k-Wave and 
Figure. c shows the same source distribution with the backward projection in mSOUND.  
<img src="/mSOUND/img/backward_logo.jpg" alt="backward projection example">
</p>


<h6>Other examples</h6>
<hr>
<p>
<br> <h7 style='font-weight:bold;'>&#11166;Forward TMDM</h7>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_homogeneous">
    Simulation of a 2D homogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_heterogeneous">
    Simulation of a 2D heterogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM-2D-strong-speed-of-sound-contrast">
    Simulation of a strongly 2D heterogeneous medium using the transient mixed domain method</a>  
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_3D_homogeneous">
    Simulation of a 3D homogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/Backward_TMDM">
    Image reconstruction using backward projection</a>   
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_animation">
    Efficient simulation with TMDM</a>   
 
<br><h7 style='font-weight:bold;'>&#11166;Forward FSMDM</h7>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_2D_homogeneous">
    Simulation of a 2D homogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_2D_heterogeneous">
    Simulation of a 2D heterogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_3D_homogeneous">
    Simulation of a 3D homogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM-3D_heterogeneous">
    Simulation of a 3D heterogeneous medium using the frequency-specific mixed domain method</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/2D_absorption">
    Reducing the spatial aliasing error using the non-reflecting layer</a>
  <br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_3D_multi_sources">
    Reconstruction of the source distribution with FSMDM in a 3D homogeneous medium</a>

 
 <br><h7 style='font-weight:bold;'>&#11166;Integration with Other Simulators</h7>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-k-Wave-TMDM">
    Integrating mSOUND with k-Wave for transducers of arbitrary shape</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-k-Wave-diffusion">
    Integrating mSOUND with k-Wave for thermal simulations</a> 
</p>
